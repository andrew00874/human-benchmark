<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>반응속도 테스트 (평균)</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #282c34;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        text-align: center;
      }
      #container {
        width: 80%;
        max-width: 600px;
      }
      h1 {
        font-size: 2.5em;
        margin-bottom: 20px;
      }
      #test-area {
        width: 100%;
        height: 300px;
        background-color: #61dafb; /* 대기 (파란색) */
        border-radius: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.8em;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s;
        user-select: none; /* 텍스트 드래그 방지 */
      }
      #test-area.waiting {
        background-color: #cf3c3c; /* 준비 (빨간색) */
      }
      #test-area.ready {
        background-color: #4caf50; /* 클릭 (초록색) */
      }
      #result {
        margin-top: 20px;
        font-size: 1.5em;
        height: 50px; /* 결과 표시 공간 확보 */
      }
    </style>
  </head>
  <body>
    <div id="container">
      <h1>반응속도 테스트 (평균)</h1>
      <div id="test-area">여기를 클릭해서 시작하세요</div>
      <p id="result">총 3번의 테스트를 진행합니다.</p>
    </div>

    <script>
      const testArea = document.getElementById("test-area");
      const result = document.getElementById("result");

      let state = "start";
      let timer;
      let startTime;

      // ================= 추가된 부분 =================
      let reactionTimes = []; // 반응속도 기록을 저장할 배열
      // ===========================================

      testArea.addEventListener("click", () => {
        if (state === "start") {
          // ================= 추가된 부분 =================
          // 3번의 테스트가 모두 끝나면 초기화
          if (reactionTimes.length === 3) {
            reactionTimes = []; // 배열 비우기
          }
          // ===========================================

          state = "waiting";
          testArea.textContent = "초록색으로 바뀌면 클릭하세요";
          testArea.classList.add("waiting");
          result.textContent = `${reactionTimes.length + 1}번째 테스트 준비...`;

          const randomTime = Math.random() * 3000 + 2000;
          timer = setTimeout(() => {
            state = "ready";
            testArea.textContent = "지금 클릭하세요!";
            testArea.classList.remove("waiting");
            testArea.classList.add("ready");
            startTime = new Date();
          }, randomTime);
        } else if (state === "waiting") {
          clearTimeout(timer);
          state = "start";
          testArea.textContent = "너무 빨라요! 다시 클릭해서 시작하세요";
          testArea.classList.remove("waiting");
          // ================= 추가된 부분 =================
          result.textContent = "3번의 테스트를 진행합니다.";
          reactionTimes = []; // 실패 시 기록 초기화
          // ===========================================
        } else if (state === "ready") {
          const endTime = new Date();
          const reactionTime = endTime - startTime;

          // ================= 수정/추가된 부분 =================
          reactionTimes.push(reactionTime); // 측정된 반응속도를 배열에 추가
          result.textContent = `기록: ${reactionTime}ms`;

          if (reactionTimes.length < 3) {
            // 테스트가 3번 미만일 경우
            state = "start";
            testArea.textContent = `성공! 다음 테스트를 위해 클릭하세요 (${reactionTimes.length}/3)`;
            testArea.classList.remove("ready");
          } else {
            // 테스트가 3번 끝났을 경우
            // 배열의 모든 값을 더함
            const sum = reactionTimes.reduce((a, b) => a + b, 0);
            // 평균을 계산 (소수점 없이)
            const average = Math.round(sum / reactionTimes.length);

            result.textContent = `3회 평균 반응속도: ${average}ms`;
            state = "start";
            testArea.textContent = "테스트 완료! 다시 하려면 클릭하세요";
            testArea.classList.remove("ready");
          }
          // =================================================
        }
      });
    </script>
  </body>
</html>
